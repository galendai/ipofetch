# Python CLI 工具项目编码规范（最终版）
## 一、CLI 核心依赖库（强制使用）
项目必须基于以下 **官方指定的 CLI 相关依赖库** 构建，禁止自行替换或混用其他同类框架：
| 功能               | 依赖库      | 版本要求     | 说明 |
|--------------------|------------|-------------|------|
| CLI 框架           | `typer`    | `>=0.9.0`   | 提供类型安全的命令行接口，自动生成帮助文档 |
| 终端美化与交互     | `rich`     | `>=13.0.0`  | 用于输出彩色文本、进度条、表格等增强用户体验 |
| HTTP 客户端        | `httpx`    | `>=0.25.0`  | 异步/同步兼容，支持 HTTP/2，优于 `requests`（便于未来扩展异步） |
| 配置管理（可选）   | `pydantic-settings` | `>=2.0.0` | 若需加载环境变量或配置文件，必须使用此库进行类型安全解析 |
> **说明**：
> - 所有依赖必须在 `pyproject.toml` 的 `[project.dependencies]` 中声明。
> - 禁止直接使用 `argparse`、`click`（除非 `typer` 无法满足极端场景，需架构师特批）。
## 二、Python 语言与编码要求
### 1. 语言版本
- 最低支持 **Python 3.8**，代码必须兼容该版本及以上。
- 禁止使用仅在 Python 3.9+ 或更高版本中引入的语言特性（如 `|` 联合类型操作符、`match-case` 等）。
### 2. 类型提示（Type Hints）
- 所有函数、方法、类属性、模块级变量必须提供完整的类型注解。
- 必须使用 `typing` 模块中的标准类型构造器（如 `Optional`, `Union`, `List`, `Dict`, `Callable`, `Protocol` 等）。
- 公共接口（如 CLI 命令函数、核心业务函数）必须具备明确的输入/输出类型契约。
### 3. 代码格式与风格
- 严格遵循 **PEP 8** 基础规范。
- 使用 **`ruff`** 作为唯一代码格式化与静态检查工具。
- 行长度限制为 **88 字符**。
- 缩进使用 **4 个空格**，禁止使用 Tab。
- 导入语句按以下顺序分组（组间空一行）：
  1. 标准库
  2. 第三方依赖（按字母序）
  3. 本地模块（按字母序）
### 4. 命名约定
- 模块、包、函数、变量、参数：`snake_case`
- 类名：`PascalCase`
- 常量（模块级不可变变量）：`UPPER_SNAKE_CASE`
- 私有成员（内部使用）：以单下划线 `_` 开头
### 5. 错误处理
- 禁止使用裸露的 `except:` 或 `except Exception:`，必须捕获具体异常类型。
- 自定义异常应继承自 `typer.Exit` 或合适的内置异常类（如 `ValueError`、`RuntimeError`）。
- 网络或 I/O 操作必须包含重试机制（默认最多 3 次，采用指数退避策略）。
### 6. 可维护性原则
- 单个函数长度不应超过 **50 行**（不含注释和空行）。
- 严格遵守 DRY（Don’t Repeat Yourself）原则，重复逻辑必须提取为函数或工具模块。
- 遵循 KISS（Keep It Simple, Stupid）原则，优先选择清晰、直接的实现方式。
### 7. 安全编码实践
- 禁止在代码中硬编码敏感信息（如邮箱、内部路径、User-Agent 中的团队标识除外）。
- 所有外部输入（命令行参数、环境变量）必须进行合法性校验。
- 构造 URL 或文件路径时，必须使用安全方式（如 `urllib.parse.urljoin`、`pathlib.Path`），禁止字符串拼接。
## 三、依赖与工具链要求
- 所有依赖必须在 `pyproject.toml` 中通过 `[project.dependencies]` 声明。
- 项目必须集成 `ruff` 作为格式化与 lint 工具，并在 CI 中强制执行。
- 禁止使用已弃用或停止维护的第三方库。
- 定期通过 `pip-audit` 或等效工具扫描依赖漏洞。
